#!/bin/bash

set -e

pushd ../../../
  cargo build --release
popd

CFLAGS="-Wl,--wrap=malloc -Wl,--wrap=free -Wl,--wrap=realloc -Werror -Wall"

gcc -O3 -c ../../memory.c -o m.o

EXTRA_FILES="m.o"

CC=$PWD/../../../target/release/libafl_cc
$CC -O0 -Wall $CFLAGS rds_kernel_CVE-2019-16714.i m.o -I../../ -o fuzz

rm -f *.o
