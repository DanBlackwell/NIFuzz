#!/bin/bash

set -e

# CFLAGS="-Wl,--wrap=malloc -Wl,--wrap=free -Wl,--wrap=realloc"
# 
# gcc -O3 -c ../../memory.c -o m.o
# 
# EXTRA_FILES="m.o"
# 
# pushd repo
#   CC=$PWD/../../../../target/release/libafl_cc
#   CXX=$PWD/../../../../target/release/libafl_cxx
#   CFLAGS="$CFLAGS -lm"
#   # ./config && make clean && make
#   ./config && make
# popd
# 
# # env $ENV_VARS 
# $CC $CFLAGS -v fuzz_harness.c $EXTRA_FILES -DCERT_PATH="./" repo/libssl.a repo/libcrypto.a -I../../ -Irepo/include -lm -ldl -o fuzz
# 
# rm -f *.o

CC=goto-cc
CFLAGS=""
pushd repo
  CC=$CC ./config && make
popd
goto-cc cbmc_harness.c -DCERT_PATH="./" repo/libssl.a repo/libcrypto.a -Irepo/include -I../../CBMC_utils -lm -ldl -o model_check
